FROM grafana/alloy:latest

COPY observability/alloy/config.alloy /etc/alloy/config.alloy

# Railway provides PORT; Alloy's HTTP server will listen on it.
EXPOSE 12345

# Base image sets ENTRYPOINT to /bin/alloy; override so we can expand $PORT.
ENTRYPOINT ["/bin/sh", "-c"]

CMD ["exec alloy run --server.http.listen-addr=0.0.0.0:${PORT:-12345} /etc/alloy/config.alloy"]

